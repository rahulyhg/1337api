<?php

/* ***************************************************************************************************
** INIT **********************************************************************************************
*************************************************************************************************** */ 
require 'rb-p533.php';
require 'config.php';

R::setup($config['db']['host'], $config['db']['user'], $config['db']['pass']);
R::setAutoResolve( TRUE );

if($config['api']['debug']){    
	R::debug( TRUE, 0 );
}

/* ***************************************************************************************************
** BEANS *********************************************************************************************
*************************************************************************************************** */ 




/* ***************************************************************************************************
** GET ROUTES ****************************************************************************************
*************************************************************************************************** */ 

if( !empty($_GET) && in_array($_GET['action'], $config['api']['get']['whitelist']) ){

	$api['action']	 = $_GET['action'];
	$api['edge']	 = $_GET['edge'];
	$api['param']	 = $_GET['param'];

	switch($api['action']) {

		case 'hi':
			$result['message'] = 'Hi, Elijah!';
			output($result);
		break;

		case 'inspect':
			$result[$api['edge']] = R::inspect($api['edge']);
			output($result);
		break;

		case 'search':
			$result['message'] = 'in development: action "search"';
			output($result);
		break;

		case 'read':
			$page = R::load( $api['edge'], $api['param'] );			
			$result['id'] = $page['id'];
			$result['title'] = $page['title'];
			output($result);

		break;

		default:
			$result['message'] = 'action not supported.';
			output($result);
		break;
	}

} 

else {
	$result['message'] = 'elijah says: you shall not pass.';
	output($result);
}

/* ***************************************************************************************************
** POST ROUTES ***************************************************************************************
*************************************************************************************************** */ 



/* ***************************************************************************************************
** RETURN FUNCTIONS **********************************************************************************
*************************************************************************************************** */ 


function output($result){
	echo json_encode($result);
}

?>	